{"version":3,"sources":["scripts.js"],"names":["recordButton","document","getElementById","buttonsElement","headerElement","stopButton","selectorFilter","endOfDoc","chunks","constraints","audio","audioCreateContainers","stream","connectHighPassFilter","connectDistordusFilter","createReverb","convolver","audioCtx","createConvolver","reader","FileReader","file","getEmulatorFile","readEmulatorFile","arrayBuffer","decodeAudioData","buffer","source","connect","distortion","makeDistortionCurve","amount","k","n_samples","curve","Float32Array","deg","Math","PI","i","x","abs","oversample","streamDestination","biquadFilter","type","frequency","setValueAtTime","currentTime","biquadFilter2","Q","gain","window","AudioContext","webkitAudioContext","createMediaStreamDestination","mediaRecorder","MediaRecorder","startRecord","start","disabled","resultofchangeButtonColorCall","changeButtonColor","console","log","onclick","ondataavailable","blobevent","push","data","stop","onstop","e","blob","Blob","audioURL","URL","createObjectURL","createElementAudioDisplay","audioFileName","createWaveShaper","createMediaStreamSource","createBiquadFilter","elementThatIsNamedSelect","addEventListener","audioFilterSelected","options","selectedIndex","value","disconnect","reverb","button","backgroundColor","textColor","style","color","audioElement","createElement","setAttribute","src","className","body","insertBefore","newTitle","createTextNode","textEdit","appendChild","onError","err","Promise","resolve","onload","evt","target","result","readAsArrayBuffer","reverbFile","files","onSuccess","navigator","mediaDevices","getUserMedia","then"],"mappings":"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","file":"scripts.b71a6038.js","sourceRoot":"..","sourcesContent":["let recordButton = document.getElementById(\"record\")\nvar buttonsElement = document.getElementById('buttons')\nvar headerElement = document.getElementById(\"Welcome\")\nlet stopButton = document.getElementById(\"stop\")\nlet selectorFilter = document.getElementById(\"audio-filters\")\nlet endOfDoc = document.getElementById('end')\nlet chunks = []\nlet constraints = { audio: true }\nlet audioCreateContainers = async function(stream) {\n    var audioCtx = new(window.AudioContext || window.webkitAudioContext)()\n    var streamDestination = audioCtx.createMediaStreamDestination()\n    const mediaRecorder = new MediaRecorder(streamDestination.stream)\n    let startRecord = function() {\n        mediaRecorder.start()\n        stopButton.disabled = false;\n        recordButton.disabled = true;\n        const resultofchangeButtonColorCall = changeButtonColor(recordButton, \"#b61827\", \"white\")\n        console.log(\"result\", resultofchangeButtonColorCall)\n    }\n    recordButton.onclick = startRecord;\n    mediaRecorder.ondataavailable = function(blobevent) {\n        chunks.push(blobevent.data);\n    }\n    stopButton.onclick = function() {\n        mediaRecorder.stop()\n        changeButtonColor(recordButton, \"rgb(255, 134,124, .4)\", \"black\")\n        stopButton.disabled = true;\n        recordButton.disabled = false;\n\n    }\n    mediaRecorder.onstop = function(e) {\n        const blob = new Blob(chunks, { 'type': 'audio/ogg; codecs=opus' });\n        chunks = [];\n        const audioURL = window.URL.createObjectURL(blob);\n        createElementAudioDisplay(audioURL)\n        audioFileName()\n    }\n\n    var distortion = audioCtx.createWaveShaper()\n    var source = audioCtx.createMediaStreamSource(stream)\n    var biquadFilter = audioCtx.createBiquadFilter()\n    var biquadFilter2 = audioCtx.createBiquadFilter()\n\n    function connectHighPassFilter() {\n        source.connect(biquadFilter)\n        biquadFilter.type = \"highpass\";\n        biquadFilter.frequency.setValueAtTime(6000, audioCtx.currentTime);\n        biquadFilter.connect(biquadFilter2)\n        biquadFilter2.type = \"peaking\";\n        biquadFilter2.frequency.setValueAtTime(7000, audioCtx.currentTime);\n        biquadFilter2.Q = 20\n        biquadFilter2.gain.setValueAtTime(30, audioCtx.currentTime);\n        biquadFilter2.connect(streamDestination)\n    }\n\n    function connectDistordusFilter() {\n        source.connect(distortion);\n\n        function makeDistortionCurve(amount) {\n            var k = typeof amount === 'number' ? amount : 60,\n                n_samples = 44100,\n                curve = new Float32Array(n_samples),\n                deg = Math.PI / 180,\n                i = 0,\n                x;\n            for (; i < n_samples; ++i) {\n                x = i * 2 / n_samples - 1;\n                curve[i] = (3 + k) * x * 20 * deg / (Math.PI + k * Math.abs(x));\n            }\n            return curve;\n        }\n        distortion.curve = makeDistortionCurve(800);\n        distortion.oversample = '4x';\n        distortion.connect(streamDestination);\n\n    }\n    async function createReverb() {\n        let convolver = audioCtx.createConvolver();\n        let reader = new FileReader()\n        let file = getEmulatorFile()\n            // equivalent aux 3 lignes suivantes \n            // readEmulatorFile (file).then(arrayBuffer => audioCtx.decodeAudioData(arrayBuffer)).then(buffer=>{\n            //     convolver.buffer=buffer\n            //     return convolver\n            // })\n        let arrayBuffer = await readEmulatorFile(file)\n        convolver.buffer = await audioCtx.decodeAudioData(arrayBuffer);\n\n        return convolver;\n\n    }\n\n    var elementThatIsNamedSelect = document.getElementById(\"audio-filters\");\n    connectDistordusFilter()\n    elementThatIsNamedSelect.addEventListener('change', async function() {\n        var audioFilterSelected = elementThatIsNamedSelect.options[elementThatIsNamedSelect.selectedIndex].value;\n        if (audioFilterSelected === \"distordus\") {\n            biquadFilter2.disconnect()\n            connectDistordusFilter()\n        } else if (audioFilterSelected === \"HighPass\") {\n            distortion.disconnect()\n            connectHighPassFilter()\n        } else if (audioFilterSelected === \"reverb\") {\n            let reverb = await createReverb()\n            distortion.disconnect()\n            biquadFilter2.disconnect()\n            source.connect(reverb)\n            reverb.connect(streamDestination)\n\n        }\n    });\n}\n\n\nfunction changeButtonColor(button, backgroundColor, textColor) {\n    button.style.backgroundColor = backgroundColor\n    button.style.color = textColor\n    return \"poute\"\n}\n\nfunction createElementAudioDisplay(audioURL) {\n    var audioElement = document.createElement('audio')\n    audioElement.setAttribute(\"controls\", true)\n    audioElement.src = audioURL\n    audioElement.className = \"audio-display-style\"\n        //audioElement.style.backgroundColor = \"rgb(255, 0, 0)\"\n    document.body.insertBefore(audioElement, endOfDoc);\n}\n\nfunction audioFileName() {\n    var newTitle = document.createTextNode(\"mon titre audio\")\n    var textEdit = document.createElement(\"div\")\n    textEdit.appendChild(newTitle)\n    document.body.insertBefore(textEdit, endOfDoc);\n}\nlet onError = function(err) {\n    console.log('The following error occured: ' + err);\n}\nasync function readEmulatorFile(file) {\n    return new Promise((resolve) => {\n        var reader = new FileReader();\n        reader.onload = function(evt) {\n            resolve(evt.target.result);\n        };\n        reader.readAsArrayBuffer(file);\n\n    })\n}\n\nfunction getEmulatorFile() {\n    var reverbFile = document.getElementById(\"reverb-file\")\n    return reverbFile.files[0]\n}\n\nlet onSuccess = function(stream) { audioCreateContainers(stream) }\nnavigator.mediaDevices.getUserMedia(constraints).then(onSuccess, onError)\n\n/*function dessiner() {\n    var canevas = document.getElementById('tutoriel');\n    if (canevas.getContext) {\n        var ctx = canevas.getContext('2d');\n\n        var rectangle = new Path2D();\n        ctx.fillStyle = 'rgb(0,0, 0)'\n        rectangle.rect(10, 10, 50, 50);\n\n        var cercle = new Path2D();\n        cercle.moveTo(125, 35);\n        cercle.arc(100, 35, 25, 0, 2 * Math.PI);\n        ctx.fillStyle = 'rgb(255, 0, 0)';\n\n\n        ctx.fill(rectangle);\n        ctx.fill(cercle);\n\n    }\n}\ndessiner() */"]}